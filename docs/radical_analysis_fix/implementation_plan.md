# 実装計画：分析エンジンの抜本的改善

## 1. 感情分析の強化 (`get_batch_sentiments`)
- **問題**: スコアが 0.0 付近に集中し、マップが「灰色（中立）」ばかりになる。
- **改善**: 
    - プロンプトで 0.0（中立）を避けるよう指示。
    - 深刻な単語（「辞めたい」「最低」「無駄」など）が含まれる場合、強制的に -0.7 以下のスコアを出すようガイド。
    - ポジティブな提案も正当に評価。

## 2. クラスタリングロジックの高度化 (`analyze_clusters_logic`)
- **問題**: HDBSCAN が少数意見をまとめて `-1 (Noise)` に分類してしまい、結果的に一つの「その他」グループに見えてしまう。
- **改善**:
    - **特異点の個別化**: `cid == -1` のデータに対し、個別の `cid`（例: `-100, -101...`）を付与し、それぞれを独立した「特異点カテゴリ」として扱う。
    - **命名の具体化**: LLM へのプロンプトを「組織開発コンサルタント」視点に強化し、10文字以内で「現場の体感」に近い言葉（「勤怠の形骸化」「ツール導入の壁」など）を生成させる。
    - **UMAPパラメータ調整**: 密集した点を分散させるため、`min_dist` や密度パラメータを微調整。

## 3. レポート生成の深化 (`generate_issue_logic_from_clusters`)
- **問題**: 件数が多いトピックばかりが Issue として抽出される。
- **改善**:
    - **分析プロトコルの追加**: プロンプトに「Step 1: 多数派分析」「Step 2: 特異点（隠れたリスク）の深掘り」というステップを明示。
    - **制約**: 「必ず 1 つ以上は、件数は少なくとも深刻なリスクを孕んだ少数意見から課題を抽出すること」という命令を追加。

## 4. テストデータの更なる多様化 (`generate_test_data.py`)
- **改善**: 
    - 文末バリエーションの追加だけでなく、具体的な IT キーワード（「CI/CD」「マイクロサービス」「心理的安全制」等）のコンビネーションを増やし、意味的な距離を散らしやすくする。

## 評価基準
- マップ上の各点が「同じような名前のカテゴリ」に分類されず、多様な色がつく。
- Issue リストに「少数意見だが重要なリスク」が含まれる。
