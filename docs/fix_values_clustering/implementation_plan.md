# 実装計画 - valuesデータにおけるクラスタリングの改善

## 1. 現状の課題
- `values`カテゴリのテストデータは、`project`など他のカテゴリに比べてテンプレートが少なく、同一または極めて類似した文章が大量に生成される。
- HDBSCANは同一座標のポイントを個別に分離できない場合があり、結果として「全データがノイズ（-1）」または「巨大な1クラスタ（0）」として判定される。
- バックエンド側でHDBSCANがクラスタを検出できなかった際のフォールバックが不十分で、一つにまとまったままLLMが名前を付けてしまうため、UI上で「すべて同じ」に見える。

## 2. 修正方針

### A. バックエンドロジックの強化 (`backend/services/analysis.py`)
- `analyze_clusters_logic` 内で、HDBSCAN実行後に `n_clusters < 2` の場合は意図的に例外をスローさせるか、直接KMeansフォールバックへ移行させる。
- これにより、データ密度に依存せず、統計的に最適なK個（現在のロジックではデータ数に応じた3〜8個）に分割されるようになる。

### B. テストデータの多様化 (`scripts/generate_test_data.py`)
- `DENSE_CLUSTERS["values"]` の各トピックにテンプレートを追加。
- データのユニーク性を高めるための処理を追加し、重複による密度の偏りを緩和する。

## 3. 期待される効果
- 重複が多いデータであっても、KMeansによって適切に複数の視点に分割される。
- クラスタリング結果のマップ上でデータが適切に散らばり、分析結果の有用性が向上する。
